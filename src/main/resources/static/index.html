<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Audit System Dashboard</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f4; }
        h1 { color: #333; }
        table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #2c3e50; color: white; }
        tr:hover { background-color: #f5f5f5; }
        .badge { padding: 5px 10px; border-radius: 4px; color: white; font-size: 0.8em; }
        .CRITICAL { background-color: #e74c3c; } /* Red */
        .HIGH { background-color: #e67e22; }     /* Orange */
        .LOW { background-color: #2ecc71; }      /* Green */
    </style>
</head>
<body>

<h1>ðŸš¨ Audit Violation Report</h1>
<p>Real-time monitoring of system anomalies.</p>

<table id="violationTable">
    <thead>
    <tr>
        <th>ID</th>
        <th>Rule Violated</th>
        <th>Severity</th>
        <th>Actor</th>
        <th>Description</th>
        <th>Time Detected</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<script>
    // 1. The URL of our API (The "Door" we just built)
    const API_URL = '/api/violations';

    // 2. Fetch the data when the page loads
    fetch(API_URL)
        .then(response => response.json()) // Convert text to JSON
        .then(data => {
            const tableBody = document.querySelector("#violationTable tbody");

            // 3. Loop through every violation and create a table row
            data.forEach(violation => {
                const row = document.createElement("tr");

                // specific logic to safely handle null actors
                const actorName = violation.relatedEvent ? violation.relatedEvent.actor : "Unknown";

                row.innerHTML = `
                        <td>${violation.id}</td>
                        <td><strong>${violation.ruleId}</strong></td>
                        <td><span class="badge ${violation.severity}">${violation.severity}</span></td>
                        <td>${actorName}</td>
                        <td>${violation.description}</td>
                        <td>${new Date(violation.detectedAt).toLocaleString()}</td>
                    `;

                tableBody.appendChild(row);
            });
        })
        .catch(error => console.error('Error fetching data:', error));
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Audit System Dashboard</title>

    <style>
        :root{
            --bg0:#06070B;
            --bg1:#0A1020;

            --text:#ECF3FF;
            --muted:#AAB7D5;
            --grid:rgba(255,255,255,.06);

            --cyan:#3CF2FF;
            --violet:#9B7CFF;
            --pink:#FF4FD8;
            --lime:#7CFFB2;

            --radius: 20px;
            --shadow: 0 22px 70px rgba(0,0,0,.65);
        }

        *{ box-sizing:border-box; }
        html,body{ height:100%; }

        body{
            margin:0;
            color:var(--text);
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
            background:
                    radial-gradient(1200px 650px at 12% 8%, rgba(60,242,255,.16), transparent 62%),
                    radial-gradient(1100px 650px at 88% 10%, rgba(155,124,255,.14), transparent 60%),
                    radial-gradient(1000px 750px at 72% 92%, rgba(255,79,216,.10), transparent 62%),
                    linear-gradient(180deg, var(--bg0), var(--bg1));
            overflow-x:hidden;
        }

        /* ===== Liquid Glass background energy ===== */
        .aurora{
            position:fixed;
            inset:-45%;
            background:
                    conic-gradient(from 210deg,
                    rgba(60,242,255,.18),
                    rgba(155,124,255,.14),
                    rgba(255,79,216,.12),
                    rgba(124,255,178,.10),
                    rgba(60,242,255,.18));
            filter: blur(80px) saturate(1.2);
            opacity:.32;
            animation: spin 18s linear infinite;
            pointer-events:none;
            z-index:0;
        }
        @keyframes spin{ to{ transform:rotate(360deg); } }

        /* Subtle scanlines (keep it very light) */
        .scanlines{
            position:fixed;
            inset:0;
            background: repeating-linear-gradient(
                    to bottom,
                    rgba(255,255,255,0.025),
                    rgba(255,255,255,0.025) 1px,
                    rgba(0,0,0,0) 3px,
                    rgba(0,0,0,0) 7px
            );
            mix-blend-mode: overlay;
            opacity:.12;
            pointer-events:none;
            z-index:1;
        }

        .wrap{
            position:relative;
            z-index:2;
            max-width: 1150px;
            margin: 44px auto;
            padding: 0 18px 52px;
        }

        header{
            display:flex;
            align-items:flex-start;
            justify-content:space-between;
            gap:16px;
            margin-bottom: 18px;
        }

        .title{
            display:flex;
            flex-direction:column;
            gap:10px;
        }

        /* Clean Apple-ish title mark (no emoji) */
        .hero-title{
            margin:0;
            font-size: clamp(26px, 3.2vw, 40px);
            letter-spacing: .25px;
            line-height: 1.08;
            display:flex;
            align-items:center;
            gap:12px;
        }
        .hero-mark{
            width: 14px;
            height: 14px;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 30%,
            rgba(255,255,255,.95),
            rgba(60,242,255,.85) 38%,
            rgba(155,124,255,.65) 62%,
            rgba(255,79,216,.45));
            box-shadow:
                    0 0 0 7px rgba(60,242,255,.10),
                    0 0 26px rgba(60,242,255,.30),
                    0 0 34px rgba(155,124,255,.22);
            flex: 0 0 auto;
        }

        .subtitle{
            margin:0;
            color:var(--muted);
            font-size: 14px;
            line-height: 1.55;
            max-width: 60ch;
        }

        /* ===== Liquid Glass pill ===== */
        .pill{
            position:relative;
            display:inline-flex;
            align-items:center;
            gap:10px;
            padding:10px 12px;
            border-radius: 999px;

            /* liquid glass material */
            background: rgba(255,255,255,.06);
            border: 1px solid rgba(255,255,255,.14);
            box-shadow:
                    0 14px 40px rgba(0,0,0,.40),
                    inset 0 1px 0 rgba(255,255,255,.22),
                    inset 0 -1px 0 rgba(255,255,255,.05);

            backdrop-filter: blur(18px) saturate(1.2);
            -webkit-backdrop-filter: blur(18px) saturate(1.2);

            color: rgba(234,242,255,.82);
            font-size: 12px;
            user-select:none;
            white-space:nowrap;
            overflow:hidden;
        }
        /* specular sweep */
        .pill::before{
            content:"";
            position:absolute;
            inset:-1px;
            background: linear-gradient(110deg,
            transparent 0%,
            rgba(255,255,255,.22) 22%,
            rgba(255,255,255,.08) 35%,
            transparent 55%);
            transform: translateX(-60%);
            animation: sheen 4.8s ease-in-out infinite;
            pointer-events:none;
            mix-blend-mode: screen;
        }
        @keyframes sheen{
            0%,55% { transform: translateX(-60%) skewX(-14deg); opacity:.0; }
            65%    { opacity:.55; }
            100%   { transform: translateX(140%) skewX(-14deg); opacity:.0; }
        }

        .dot{
            width:8px; height:8px; border-radius:999px;
            background: var(--lime);
            box-shadow: 0 0 0 6px rgba(124,255,178,.10), 0 0 16px rgba(124,255,178,.55);
            animation: pulse 1.6s ease-in-out infinite;
            flex:0 0 auto;
        }
        @keyframes pulse{
            0%,100%{ transform:scale(1); opacity:1; }
            50%{ transform:scale(1.18); opacity:.72; }
        }

        /* ===== Liquid Glass card ===== */
        .card{
            position:relative;
            border-radius: var(--radius);
            overflow:hidden;

            background: rgba(255,255,255,.055);
            border: 1px solid rgba(255,255,255,.14);
            box-shadow: var(--shadow);

            backdrop-filter: blur(22px) saturate(1.25);
            -webkit-backdrop-filter: blur(22px) saturate(1.25);

            /* keep it crisp like glass */
            transform: translateZ(0);
        }

        /* Caustic edge + tint */
        .card::before{
            content:"";
            position:absolute;
            inset:-2px;
            background:
                    radial-gradient(220px 120px at 14% 8%, rgba(60,242,255,.35), transparent 60%),
                    radial-gradient(220px 120px at 86% 12%, rgba(155,124,255,.28), transparent 60%),
                    radial-gradient(320px 160px at 50% 110%, rgba(255,79,216,.16), transparent 70%),
                    linear-gradient(90deg, rgba(60,242,255,.35), rgba(155,124,255,.30), rgba(255,79,216,.26));
            filter: blur(18px);
            opacity:.20;
            z-index:0;
            pointer-events:none;
        }

        /* Inner reflections + subtle refraction-ish texture */
        .card::after{
            content:"";
            position:absolute;
            inset:0;
            background:
                /* inner top highlight */
                    linear-gradient(180deg, rgba(255,255,255,.20), rgba(255,255,255,.00) 40%),
                        /* side reflections */
                    radial-gradient(900px 260px at -10% 35%, rgba(255,255,255,.10), transparent 55%),
                    radial-gradient(900px 260px at 110% 40%, rgba(255,255,255,.08), transparent 55%),
                        /* faint “ripple” noise */
                    repeating-radial-gradient(circle at 20% 20%,
                    rgba(255,255,255,.025) 0px,
                    rgba(255,255,255,.025) 2px,
                    rgba(0,0,0,0) 6px,
                    rgba(0,0,0,0) 12px);
            opacity:.55;
            z-index:0;
            pointer-events:none;
            mix-blend-mode: overlay;
        }

        .card-inner{
            position:relative;
            z-index:1;
            padding: 14px;

            /* slightly darker “content plane” floating inside glass */
            background: linear-gradient(180deg, rgba(10,14,28,.58), rgba(10,14,28,.40));
            border-radius: calc(var(--radius) - 6px);

            box-shadow:
                    inset 0 1px 0 rgba(255,255,255,.14),
                    inset 0 -1px 0 rgba(255,255,255,.06);
        }

        table{
            width:100%;
            border-collapse: separate;
            border-spacing: 0;
            overflow:hidden;
            border-radius: calc(var(--radius) - 10px);
        }

        thead th{
            position:sticky;
            top:0;
            z-index:2;
            text-align:left;
            font-weight: 650;
            letter-spacing: .42px;
            font-size: 12px;
            color: rgba(234,242,255,.92);
            padding: 14px 14px;

            /* glass header strip */
            background: rgba(255,255,255,.06);
            border-bottom: 1px solid rgba(255,255,255,.10);

            backdrop-filter: blur(14px) saturate(1.2);
            -webkit-backdrop-filter: blur(14px) saturate(1.2);
        }

        tbody td{
            padding: 14px 14px;
            color: rgba(234,242,255,.90);
            border-bottom: 1px solid var(--grid);
            vertical-align: middle;
            font-size: 14px;
        }

        tbody tr{
            transition: transform .15s ease, background .15s ease, box-shadow .15s ease;
        }

        tbody tr:hover{
            background: rgba(255,255,255,.035);
            box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
            transform: translateY(-1px);
        }

        th:nth-child(1), td:nth-child(1){ width: 70px; color: rgba(170,183,213,.95); }
        th:nth-child(3), td:nth-child(3){ width: 120px; }
        th:nth-child(4), td:nth-child(4){ width: 160px; }

        .rule{
            font-weight: 700;
            letter-spacing:.2px;
            color: rgba(234,242,255,.95);
        }

        /* Liquid glass badge (glossier + inner edge) */
        .badge{
            position:relative;
            display:inline-flex;
            align-items:center;
            gap:8px;
            padding: 7px 10px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 750;
            letter-spacing:.45px;
            text-transform: uppercase;

            background: rgba(255,255,255,.06);
            border: 1px solid rgba(255,255,255,.16);
            box-shadow:
                    0 10px 22px rgba(0,0,0,.30),
                    inset 0 1px 0 rgba(255,255,255,.22),
                    inset 0 -1px 0 rgba(255,255,255,.06);

            backdrop-filter: blur(12px) saturate(1.15);
            -webkit-backdrop-filter: blur(12px) saturate(1.15);

            overflow:hidden;
        }
        .badge::before{
            content:"";
            width:8px; height:8px; border-radius:999px;
            background: currentColor;
            box-shadow: 0 0 0 6px rgba(255,255,255,.05), 0 0 18px currentColor;
            opacity:.9;
            flex:0 0 auto;
        }
        .badge::after{
            content:"";
            position:absolute;
            inset:-1px;
            background: linear-gradient(110deg,
            transparent 0%,
            rgba(255,255,255,.22) 24%,
            rgba(255,255,255,.06) 38%,
            transparent 56%);
            transform: translateX(-70%) skewX(-14deg);
            animation: sheen 5.6s ease-in-out infinite;
            pointer-events:none;
            mix-blend-mode: screen;
            opacity:.55;
        }

        .CRITICAL{ color: #FF4B6E; }
        .HIGH{ color: #FFB020; }
        .LOW{ color: #56FFB7; }

        .state{
            display:flex;
            align-items:center;
            justify-content:center;
            padding: 26px 12px;
            color: var(--muted);
            font-size: 14px;
            gap:10px;
        }
        .spinner{
            width:14px; height:14px;
            border-radius: 999px;
            border: 2px solid rgba(255,255,255,.18);
            border-top-color: rgba(60,242,255,.8);
            animation: rot .8s linear infinite;
        }
        @keyframes rot{ to{ transform: rotate(360deg); } }

        @media (max-width: 820px){
            header{ flex-direction:column; align-items:flex-start; }
            th:nth-child(5), td:nth-child(5){ display:none; }
        }
    </style>
</head>

<body>
<div class="aurora"></div>
<div class="scanlines"></div>

<div class="wrap">
    <header>
        <div class="title">
            <h1 class="hero-title"><span class="hero-mark" aria-hidden="true"></span>Audit Violation Report</h1>
            <p class="subtitle">Real-time monitoring of system anomalies with Liquid Glass depth.</p>
        </div>
        <div class="pill"><span class="dot"></span> Live feed • Auto-refresh on load</div>
    </header>

    <div class="card">
        <div class="card-inner">
            <table id="violationTable">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Rule Violated</th>
                    <th>Severity</th>
                    <th>Actor</th>
                    <th>Description</th>
                    <th>Time Detected</th>
                </tr>
                </thead>
                <tbody>
                <tr id="loadingRow">
                    <td colspan="6">
                        <div class="state"><span class="spinner"></span>Loading violations…</div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const API_URL = '/api/violations';

    const tableBody = document.querySelector("#violationTable tbody");
    const loadingRow = document.getElementById("loadingRow");

    function showMessageRow(message) {
        if (loadingRow) loadingRow.remove();
        const row = document.createElement("tr");
        row.innerHTML = `<td colspan="6"><div class="state">${message}</div></td>`;
        tableBody.appendChild(row);
    }

    // Never spin forever
    const controller = new AbortController();
    const timeout = setTimeout(() => controller.abort(), 8000);

    fetch(API_URL, {
        method: "GET",
        cache: "no-store",
        headers: { "Accept": "application/json" },
        signal: controller.signal
    })
        .then(async (res) => {
            clearTimeout(timeout);

            if (!res.ok) {
                const text = await res.text().catch(() => "");
                throw new Error(`HTTP ${res.status} ${res.statusText} ${text}`.trim());
            }

            return res.json();
        })
        .then((payload) => {
            // Supports: array OR wrapper objects (Page/content, data, etc.)
            const data =
                Array.isArray(payload) ? payload :
                    Array.isArray(payload.content) ? payload.content :
                        Array.isArray(payload.data) ? payload.data :
                            [];

            if (loadingRow) loadingRow.remove();

            if (!data || data.length === 0) {
                showMessageRow("No violations found. System looks clean.");
                return;
            }

            data.forEach(violation => {
                const row = document.createElement("tr");
                const actorName = violation.relatedEvent ? violation.relatedEvent.actor : "Unknown";

                row.innerHTML = `
            <td>${violation.id ?? ""}</td>
            <td><span class="rule">${violation.ruleId ?? ""}</span></td>
            <td><span class="badge ${violation.severity ?? ""}">${violation.severity ?? ""}</span></td>
            <td>${actorName}</td>
            <td>${violation.description ?? ""}</td>
            <td>${violation.detectedAt ? new Date(violation.detectedAt).toLocaleString() : ""}</td>
          `;
                tableBody.appendChild(row);
            });
        })
        .catch((err) => {
            console.error("Error fetching violations:", err);
            const msg =
                err.name === "AbortError"
                    ? "⚠️ API request timed out. Is /api/violations reachable?"
                    : "⚠️ Error fetching data. Open DevTools → Console/Network for details.";
            showMessageRow(msg);
        });
</script>
</body>
</html>
